include: 
- "setLattice_configs/defaults.yml"
- "setLattice_configs/bounds.yml"

####################
########################################
############################################################
################################################################################
####################################################################################################
########################################################################################################################

#Injector settings

########################################################################################################################
####################################################################################################
################################################################################
############################################################
########################################
####################





#inputBeamFilePathSuffix : '/beams/2025-05-14_twobunch_unoptimized_shorterSpacing/2025-05-14_twobunch_unoptimized_shorterSpacing.h5'
inputBeamFilePathSuffix : '/beams/2025-05-13_twobunch_unoptimized_shortSpacing/2025-05-13_twobunch_unoptimized_shortSpacing.h5' #2025-06-21-08-58-49 I'm pretty pessimistic about this. Pretty large parameter scans don't give encouraging results
#inputBeamFilePathSuffix : '/beams/2024-10-14_Impact_TwoBunch/2024-10-14_TwoBunch.h5'


#As of 2025-06-17-10-25-25, continuing to use "2024-10-14_twoBunch_baseline.yml" injector settings without further optimization
bunchCount : 2
QA10361kG : -2.2481515833
QA10371kG : 2.338890812
QE10425kG : -1.0721888188
QE10441kG : 1.3152401751
QE10511kG : 0.2241208022
QE10525kG : 0.6276060908
L0BPhaseSet : -15.0  #By eye, this "feels" right... it should be a fit parameter though
L0BEnergyOffset : -2259313 #This new beam comes out of L0A just at a tiny bit higher energy. Compensate in L0B to get to the design 125 MeV



####################
########################################
############################################################
################################################################################
####################################################################################################
########################################################################################################################

#These are the post-L3 magnet values in defaults.yml as of 2025-06-17-10-33-57, MANUALLY SCALED by 6/10 to make them compatible with the new target energy

########################################################################################################################
####################################################################################################
################################################################################
############################################################
########################################
####################



#BC20 launch quads with independent EPICS control
Q19851kG : -38.457   #-64.095
Q19871kG : 26.9616  #44.936

#BC20 bends
B1EkG :  4.5198   #7.533
B2EkG :  -6.5652    #-10.942
B3EkG :  2.0454    #3.409

#BC20 quads
Q1EkG : 96.7866  # 161.311
Q2EkG : -92.5374  # -154.229
Q3EkG : 66.1302  # 110.217
Q4EkG : 79.3608  # 132.268
Q5EkG : -14.0238  # -23.373
Q6EkG : -85.3626  # -142.271

#BC20 sextupoles
S1ELkG : 482.9226  # 804.871
S2ELkG : -1229.6934  # -2049.489
S3ELkG : -611.5938  # -1019.3230 
S3ERkG : -611.5938  # -1019.3230 
S2ERkG : -1229.6934  # -2049.489 
S1ERkG : 482.9226  # 804.871

#IP quads
Q5FFkG : -43.1022  # -71.837
Q4FFkG : -48.7506  # -81.251
Q3FFkG : 59.535  # 99.225
Q2FFkG : 75.81  # 126.35
Q1FFkG : -141.1308  # -235.218
Q0FFkG : 75.8118  # 126.353
Q0DkG :  -65.8164  #-109.694
Q1DkG :  108.5172  #180.862
Q2DkG :  -65.8164  #-109.694

#Final focus kickers
XC1FFkG: 0.0
XC3FFkG: 0.0
YC1FFkG: 0.0
YC2FFkG: 0.0




####################
########################################
############################################################
################################################################################
####################################################################################################
########################################################################################################################

#Optimizer values

########################################################################################################################
####################################################################################################
################################################################################
############################################################
########################################
####################




#PENDING
centerBC14 : True
centerBC20 : True
centerMFFF : True
assertBC14Energy : 4.5e+9
assertBC20Energy : 6.0e+9
symmetricSextupoleStrengths : False


# L1PhaseSet : -32.7342594561
# L2PhaseSet : -43.3671351973
# L3PhaseSet : -32.162759978
#L2EnergyOffset : -6.817565553821569e+6
L2EnergyOffset : 0.0
L3EnergyOffset : -4.0e+9

L1PhaseSet : -22
L2PhaseSet : -40
# # L3PhaseSet : -32.162759978

# B1EkG : 4.2714401886
# B2EkG : -6.995081022
# B3EkG : 2.4956238719
# Q1EkG : 94.8044781735
# Q2EkG : -92.4415507372
# Q3EkG : 64.6095312121
# Q4EkG : 64.3838956117
# Q5EkG : -0.1279499406
# Q6EkG : -1.0636590049
# S1ELkG : 480.5795294461
# S2ELkG : -1625.5206286223
# S3ELkG : -2.4518404236



# L1PhaseSet : -25.9195405027
# L2PhaseSet : -44.8600422018
# L3PhaseSet : -2.0588751421
# B1EkG : 4.525555844
# B2EkG : -6.5609006647
# B3EkG : 2.0463688843
# Q1EkG : 99.6146437891
# Q2EkG : -91.6431654717
# Q3EkG : 65.78179991
# Q4EkG : 77.6041624244
# Q5EkG : -6.9381390934
# Q6EkG : -89.3767936919
# S1ELkG : 1019.1350695007
# S2ELkG : -2192.0520837087
# S3ELkG : -768.3975718376
# S3ERkG : -597.4699244334
# S2ERkG : -1583.8827369541
# S1ERkG : 442.6255578752
# S1EL_xOffset : -0.0002210808
# S1EL_yOffset : -0.0001779802
# S2EL_xOffset : 0.0001777181
# S2EL_yOffset : -0.0000941324
# S2ER_xOffset : 0.0008566029
# S2ER_yOffset : -0.0008701895
# S1ER_xOffset : 0.0013358444
# S1ER_yOffset : -0.0007047907

# L1PhaseSet : -22
# L2PhaseSet : -40
# Q1EkG : 100.609276622
# Q2EkG : -94.9352359441
# Q3EkG : 82.6695093709
# Q4EkG : 47.3890608058
# Q5EkG : -36.3196500584
# Q6EkG : -44.5080211444
# S1ELkG : 2329.3575567228
# S2ELkG : -11057.9040420116
# S3ELkG : -496.3369025612
# S3ERkG : -2297.1605194601
# S2ERkG : -20471.344165027
# S1ERkG : 2299.6817556054


#2025-06-23-10-13-26 Analytic R56 = -14 mm. With these L1/L2 phases, gives 40 um spacing, albeit with charge loss
# L1PhaseSet : -22
# L2PhaseSet : -40
# Q1EkG : 97.1596722
# Q2EkG : -105.37180621
# Q3EkG : 65.50817387
# Q4EkG : 80.11655116
# Q5EkG : -5.68225198
# Q6EkG : -96.78779666



# Q19851kG : -33.7719887064
# Q19871kG : 34.7720974328
# Q1EkG : 96.5032099722
# Q2EkG : -93.136549827
# Q3EkG : 64.1392508488
# Q4EkG : 67.7855360933
# Q5EkG : -0.2648674525
# Q6EkG : -0.078349615




########
# Going to try to sneak up on it. Starting from target spacing of 200 um
# For now, alignment terms are off. Only allowing phases, sextupole strengths, BC20 quads and launch quads
# These are all with the nominal PSDL, "2024-10-14_TwoBunch.h5'"
########



# 2025-06-23-15-50-12 150+/-50 um spacing
# L1PhaseSet : -32.4823816888
# L2PhaseSet : -39.0845984107
# L3PhaseSet : -0.8437397245
# Q19851kG : -38.2903253809
# Q19871kG : 25.8661173006
# Q1EkG : 92.3878572277
# Q2EkG : -91.3014107286
# Q3EkG : 65.0608804785
# Q4EkG : 81.8184288858
# Q5EkG : -14.6631994105
# Q6EkG : -84.5171275352
# S1ELkG : 433.9585282203
# S2ELkG : -1264.0113774695
# S3ELkG : -622.6940849048
# S3ERkG : -592.9964191619
# S2ERkG : -1213.5690421113
# S1ERkG : 486.0497385586

# 100+/-20 um spacing
# L1PhaseSet : -33.3018452064
# L2PhaseSet : -39.5239701776
# L3PhaseSet : 0.2044782091
# Q19851kG : -37.1865604814
# Q19871kG : 26.6077538917
# Q1EkG : 94.4727446706
# Q2EkG : -96.4559879612
# Q3EkG : 64.3705340378
# Q4EkG : 87.347083941
# Q5EkG : -14.4480445572
# Q6EkG : -90.6728845396
# S1ELkG : 422.3417893915
# S2ELkG : -1438.0813116231
# S3ELkG : -559.5080009209
# S3ERkG : -625.1656252056
# S2ERkG : -1321.5246507941
# S1ERkG : 564.0967746952

# 50+/-20 um spacing



########
# Didn't give the above a sufficient try. But wrote an optimizer variant that updates target spacing adiabatically 
########
# L1PhaseSet : -32.4823816888
# L2PhaseSet : -39.0845984107

#2025-06-24-07-13-18 Possibly successful 60 um spacing... not carefully investigated though
# L1PhaseSet : -33.3531445013
# L2PhaseSet : -39.9971627494
# L3PhaseSet : 36.5571488597
# Q19851kG : -35.0383873112
# Q19871kG : 30.7143110129
# Q1EkG : 79.4649139966
# Q2EkG : -92.6489175227
# Q3EkG : 65.3786425107
# Q4EkG : 84.4910551114
# Q5EkG : -21.3891912197
# Q6EkG : -77.5875927838
# S1ELkG : 635.8574170183
# S2ELkG : -1798.3655963564
# S3ELkG : -1683.4458022513
# S3ERkG : -777.6838500757
# S2ERkG : -2576.1128498432
# S1ERkG : 157.0764996136

# 2025-06-24-15-13-12 Checkpoint save...  40 um spacing, CSR off
# L1PhaseSet : -33.692824458
# L2PhaseSet : -41.0288746126
# L3PhaseSet : 37.4595219539
# Q19851kG : -38.0620536428
# Q19871kG : 30.4420988741
# B1EkG : 4.4986570242
# B2EkG : -6.5712873046
# B3EkG : 2.0531569613
# Q1EkG : 76.4767975884
# Q2EkG : -91.4637545349
# Q3EkG : 65.8747582223
# Q4EkG : 79.2430700286
# Q5EkG : -19.7641103893
# Q6EkG : -85.6882283193
# S1ELkG : 603.2453030526
# S2ELkG : -3657.6109950149
# S3ELkG : -1838.0028973266
# S3ERkG : -824.2910781689
# S2ERkG : -1781.6782061383
# S1ERkG : 261.1863118541



# inputBeamFilePathSuffix : '/beams/2025-05-13_twobunch_unoptimized_shortSpacing/2025-05-13_twobunch_unoptimized_shortSpacing.h5'
# L1PhaseSet : -20.0
# L2PhaseSet : -36.0
# Q19851kG : -38.1131288884
# Q19871kG : 26.2280913193
# Q1EkG : 93.7225309101
# Q2EkG : -94.3532213668
# Q3EkG : 71.0203530369
# Q4EkG : 64.3688767228
# Q5EkG : -1.4011003282
# Q6EkG : -96.7174269387
# S1ELkG : 773.1818673466
# S2ELkG : -5396.8462296633
# S3ELkG : -607.506841463
# S3ERkG : -244.8882750228
# S2ERkG : -3482.872495901
# S1ERkG : 592.9774351948


# # 2025-06-25-11-55-49 Checkpoint... promising
# inputBeamFilePathSuffix : '/beams/2025-05-13_twobunch_unoptimized_shortSpacing/2025-05-13_twobunch_unoptimized_shortSpacing.h5'
# L1PhaseSet : -22.0051276344
# L2PhaseSet : -36.5106749907
# L3PhaseSet : -0.862057015
# Q19851kG : -37.4002050813
# Q19871kG : 30.8619323962
# B1EkG : 4.5189299841
# B2EkG : -6.5639591756
# B3EkG : 2.0449442178
# Q1EkG : 94.2413007409
# Q2EkG : -95.7279456731
# Q3EkG : 71.5902844185
# Q4EkG : 63.9592394196
# Q5EkG : -1.1347942232
# Q6EkG : -97.3358241567
# S1ELkG : 764.5179697802
# S2ELkG : -5806.1835082724
# S3ELkG : -618.4100566917
# S3ERkG : -242.8046391243
# S2ERkG : -3390.9264605342
# S1ERkG : 571.8774689881
# S1EL_xOffset : -0.0001263746
# S1EL_yOffset : 0.0000104613
# S2EL_xOffset : 0.0000196735
# S2EL_yOffset : -0.0000666698
# S2ER_xOffset : 0.0000305803
# S2ER_yOffset : 0.0000277558
# S1ER_xOffset : -8.94e-8
# S1ER_yOffset : 0.0000610342





# L1PhaseSet : -22.0967314781
# L2PhaseSet : -36.5557854617
# L3PhaseSet : -1.091666817
# Q19851kG : -36.3436597149
# Q19871kG : 32.6883490482
# B1EkG : 4.5197754946
# B2EkG : -6.5423864576
# B3EkG : 2.0443146079
# Q1EkG : 90.0682073782
# Q2EkG : -96.4274401325
# Q3EkG : 72.2150648388
# Q4EkG : 61.857306277
# Q5EkG : -1.1190558489
# Q6EkG : -98.0361983155
# S1ELkG : 786.6583421215
# S2ELkG : -5704.1206037904
# S3ELkG : -646.4237767595
# S3ERkG : -306.0510118515
# S2ERkG : -3772.7157115995
# S1ERkG : 443.9900606566
# S1EL_xOffset : -0.0002217062
# S1EL_yOffset : -0.0000543221
# S2EL_xOffset : 0.000686947
# S2EL_yOffset : -0.0000378283
# S2ER_xOffset : -0.0000514461
# S2ER_yOffset : 0.0001702628
# S1ER_xOffset : 0.0000336726
# S1ER_yOffset : 0.0002650434


# Q19851kG : -38.2132056361
# Q19871kG : 31.6478149157
# B1EkG : 4.5244912803
# B2EkG : -6.5432940685
# B3EkG : 2.0438177927
# Q1EkG : 86.5228036272
# Q2EkG : -96.423125565
# Q3EkG : 73.2348184326
# Q4EkG : 61.7024588139
# Q5EkG : -0.0355978544
# Q6EkG : -97.4891000613
# S1ELkG : 857.2929557882
# S2ELkG : -6847.6506168741
# S3ELkG : -591.7219645406
# S3ERkG : -529.1226135595
# S2ERkG : -4304.0649071519
# S1ERkG : 439.6269812043
# S1EL_xOffset : 0.0001444838
# S1EL_yOffset : -0.0001135009
# S2EL_xOffset : 0.0002358043
# S2EL_yOffset : -0.0000708814
# S2ER_xOffset : -0.0004157129
# S2ER_yOffset : 0.0001874394
# S1ER_xOffset : 0.0002810004
# S1ER_yOffset : 0.0007203658

# #2025-06-26-13-26-40
# L1PhaseSet : -22.1933526385
# L2PhaseSet : -36.5340101755
# L3PhaseSet : 0.1733005478
# Q19851kG : -38.868093261
# Q19871kG : 31.9107520355
# B1EkG : 4.5332254677
# B2EkG : -6.5360449155
# B3EkG : 2.0445630892
# Q1EkG : 88.6836388806
# Q2EkG : -96.7473217193
# Q3EkG : 73.2039086407
# Q4EkG : 61.7212241378
# Q5EkG : -1.0139651853
# Q6EkG : -96.7306367637
# S1ELkG : 1066.4210769424
# S2ELkG : -6765.9812906694
# S3ELkG : -633.2258239098
# S3ERkG : -467.6142640006
# S2ERkG : -4371.7296289327
# S1ERkG : 438.0331039112
# S1EL_xOffset : 0.0001006968
# S1EL_yOffset : -0.0002934569
# S2EL_xOffset : 0.0002705722
# S2EL_yOffset : -0.0001444627
# S2ER_xOffset : -0.0004957649
# S2ER_yOffset : 0.0002412736
# S1ER_xOffset : 0.0003425561
# S1ER_yOffset : 0.0003844306


# #2025-06-27-13-19-29
# L1PhaseSet : -22.312460554
# L2PhaseSet : -36.8934143515
# L3PhaseSet : 5.0605547547
# Q19851kG : -39.0478674454
# Q19871kG : 34.5711314807
# B1EkG : 4.5382530133
# B2EkG : -6.5350764727
# B3EkG : 2.0391969418
# Q1EkG : 88.2021579829
# Q2EkG : -96.3500200532
# Q3EkG : 73.2642043527
# Q4EkG : 61.1405419561
# Q5EkG : -1.3095850502
# Q6EkG : -97.8411277853
# S1ELkG : 1239.6142929415
# S2ELkG : -6881.0716642501
# S3ELkG : -401.331765673
# S3ERkG : -468.467545289
# S2ERkG : -4444.5603272139
# S1ERkG : 425.5852592044
# S1EL_xOffset : 0.0001190819
# S1EL_yOffset : -0.0002702728
# S2EL_xOffset : 0.0002553218
# S2EL_yOffset : -0.0001600154
# S2ER_xOffset : -0.0004706572
# S2ER_yOffset : 0.0003234119
# S1ER_xOffset : 0.0001141045
# S1ER_yOffset : 0.0004201908


# symmetricSextupoleStrengths : True
# L1PhaseSet : -20.0
# L2PhaseSet : -36.0
# Q19851kG : -38.3933893191
# Q19871kG : 21.2977684404
# Q1EkG : 72.1425897769
# Q2EkG : -109.0203271597
# Q3EkG : 72.0792576664
# Q4EkG : 73.4856974542
# Q5EkG : -0.447733494
# Q6EkG : -100.0916519126
# S1ELkG : 2572.6783516183
# S2ELkG : -6842.2131340099
# S3ELkG : -1167.3213371143

# PENDING. Now aiming for 60 um spacing
L1PhaseSet : -22.7394347731
L2PhaseSet : -41.4326671512
L3PhaseSet : 10.4999151169
Q19851kG : -45.491967666
Q19871kG : 44.3158730718
Q1EkG : 79.1922062247
Q2EkG : -88.2309811411
Q3EkG : 72.0621096823
Q4EkG : 58.3842385176
Q5EkG : -8.1746682272
Q6EkG : -85.7287263764
S1ELkG : 429.3105843763
S2ELkG : -3002.8159026039
S3ELkG : -622.0171442885
S3ERkG : -577.2793102651
S2ERkG : -8073.3955026315
S1ERkG : 571.3814652704

S1EL_xOffset : 0.0003463463
S1EL_yOffset : -0.0000116523
S2EL_xOffset : -0.0004863192
S2EL_yOffset : 0.0000427686
S2ER_xOffset : 0.0019476706
S2ER_yOffset : 5.3233e-6
S1ER_xOffset : 0.0000250703
S1ER_yOffset : 0.0002374772
